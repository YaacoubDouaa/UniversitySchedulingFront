

<div class="rooms-container">
  <mat-card>
    <mat-card-header>
      <mat-card-title>Room Availability</mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <form class="filter-form">
        <mat-form-field appearance="outline">
          <mat-label>Day</mat-label>
          <mat-select [(ngModel)]="selectedDay" name="day">
            <mat-option *ngFor="let day of days" [value]="day">{{ day }}</mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Time</mat-label>
          <mat-select [(ngModel)]="selectedTime" name="time">
            <mat-option *ngFor="let time of times" [value]="time">{{ time }}</mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Type</mat-label>
          <mat-select [(ngModel)]="selectedType" name="type">
            <mat-option value="">All</mat-option>
            <mat-option *ngFor="let type of types" [value]="type">{{ type }}</mat-option>
          </mat-select>
        </mat-form-field>
      </form>
    </mat-card-content>
  </mat-card>

  <div *ngIf="selectedTime !== '' && selectedDay !== ''" class="rooms-grid">
    <mat-card *ngFor="let salle of Object.keys(salles)" class="room-card"
              [ngClass]="{'available': isSalleAvailable(salle, selectedDay, selectedTime), 'occupied': !isSalleAvailable(salle, selectedDay, selectedTime)}"
              [style.display]="shouldDisplaySalle(salles[salle]) ? 'block' : 'none'">
      <mat-card-header>
        <mat-card-title>{{ salle }}</mat-card-title>
        <mat-card-subtitle>{{ salles[salle].type }} - Capacity: {{ salles[salle].capacite }}</mat-card-subtitle>
      </mat-card-header>
      <mat-card-content>
        <p class="availability">
          {{ isSalleAvailable(salle, selectedDay, selectedTime) ? "Available" : "Occupied" }}
        </p>
      </mat-card-content>
      <mat-card-actions>
        <button mat-button color="primary" *ngIf="isSalleAvailable(salle, selectedDay, selectedTime)"
                (click)="openAddModal(selectedDay, selectedTime)">Add Session</button>
        <button mat-button color="primary" (click)="onSelectSalle(salles[salle].schedule)">View Schedule</button>
        <button mat-button color="primary" *ngIf="!isSalleAvailable(salle, selectedDay, selectedTime)"
                (click)="openViewModal(salle, selectedDay, selectedTime)">View Session</button>
      </mat-card-actions>
    </mat-card>
  </div>
</div>

<ng-container *ngIf="selectedActivity">
  <div class="modal-overlay" (click)="closeModal($event)">
    <mat-card class="modal-card" (click)="$event.stopPropagation()">
      <mat-card-header>
        <mat-card-title>{{ selectedActivity.seance.id ? 'Edit Session' : 'Add Session' }}</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <form class="session-form">
          <mat-form-field appearance="outline">
            <mat-label>Session Name</mat-label>
            <input matInput [(ngModel)]="selectedActivity.seance.name" name="name" required>
          </mat-form-field>
          <mat-form-field appearance="outline">
            <mat-label>Professor</mat-label>
            <input matInput [(ngModel)]="selectedActivity.seance.professor" name="professor" required>
          </mat-form-field>
          <mat-form-field appearance="outline">
            <mat-label>Type</mat-label>
            <mat-select [(ngModel)]="selectedActivity.seance.type" name="type" required>
              <mat-option *ngFor="let type of types" [value]="type">{{ type }}</mat-option>
            </mat-select>
          </mat-form-field>
        </form>
      </mat-card-content>
      <mat-card-actions align="end">
        <button mat-button (click)="closeModal()">Cancel</button>
        <button mat-raised-button color="primary"
                (click)="selectedActivity.seance.id ? saveEditChanges() : saveAddChanges()">
          Save
        </button>
      </mat-card-actions>
    </mat-card>
  </div>
</ng-container>

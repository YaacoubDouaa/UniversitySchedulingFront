

<div class="rattrapage-container">
  <mat-card>
    <mat-card-header>
      <mat-icon mat-card-avatar>event_note</mat-icon>
      <mat-card-title>Propositions de Rattrapage</mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <table mat-table [dataSource]="propositions" class="mat-elevation-z8">
        <!-- ID Column -->
        <ng-container matColumnDef="id">
          <th mat-header-cell *matHeaderCellDef>
            <mat-icon class="header-icon">tag</mat-icon> ID
          </th>
          <td mat-cell *matCellDef="let prop">{{prop.id}}</td>
        </ng-container>

        <!-- Date Column -->
        <ng-container matColumnDef="date">
          <th mat-header-cell *matHeaderCellDef>
            <mat-icon class="header-icon">calendar_today</mat-icon> Date
          </th>
          <td mat-cell *matCellDef="let prop">{{prop.date | date:'dd/MM/yyyy'}}</td>
        </ng-container>

        <!-- Reason Column -->
        <ng-container matColumnDef="reason">
          <th mat-header-cell *matHeaderCellDef>
            <mat-icon class="header-icon">description</mat-icon> Raison
          </th>
          <td mat-cell *matCellDef="let prop">{{prop.reason}}</td>
        </ng-container>

        <!-- Status Column -->
        <ng-container matColumnDef="status">
          <th mat-header-cell *matHeaderCellDef>
            <mat-icon class="header-icon">info</mat-icon> Statut
          </th>
          <td mat-cell *matCellDef="let prop">
            <span class="status-badge" [ngClass]="{
              'status-pending': prop.status === 'En attente',
              'status-confirmed': prop.status === 'Confirmé',
              'status-rejected': prop.status === 'Refusé'
            }">

              {{prop.status}}
            </span>
          </td>
        </ng-container>

        <!-- Enseignant ID Column -->
        <ng-container matColumnDef="enseignantId">
          <th mat-header-cell *matHeaderCellDef>
            <mat-icon class="header-icon">person</mat-icon> Enseignant
          </th>
          <td mat-cell *matCellDef="let prop">{{prop.enseignantId}}</td>
        </ng-container>

        <!-- Type Column -->
        <ng-container matColumnDef="type">
          <th mat-header-cell *matHeaderCellDef>
            <mat-icon class="header-icon">category</mat-icon> Type
          </th>
          <td mat-cell *matCellDef="let prop">{{prop.type}}</td>
        </ng-container>

        <!-- Niveau Column -->
        <ng-container matColumnDef="niveau">
          <th mat-header-cell *matHeaderCellDef>
            <mat-icon class="header-icon">school</mat-icon> Niveau
          </th>
          <td mat-cell *matCellDef="let prop">{{prop.niveau}}</td>
        </ng-container>

        <!-- Salle Column -->
        <ng-container matColumnDef="salle">
          <th mat-header-cell *matHeaderCellDef>
            <mat-icon class="header-icon">room</mat-icon> Salle
          </th>
          <td mat-cell *matCellDef="let prop">
            <ng-container *ngIf="prop.status === 'Confirmé'">
              <mat-form-field appearance="outline" class="salle-field">
                <mat-label>Sélectionner une salle</mat-label>
                <mat-select [(ngModel)]="prop.salle"
                            (selectionChange)="updateSalle($event.value, prop.id)">
                  <mat-option *ngFor="let salle of sallesList" [value]="salle">
                    {{salle}}
                  </mat-option>
                </mat-select>
                <mat-icon matSuffix>meeting_room</mat-icon>
              </mat-form-field>
            </ng-container>
            <span *ngIf="prop.status !== 'Confirmé'" class="disabled-text">
      Non disponible
    </span>
          </td>
        </ng-container>
        <!-- Actions Column -->
        <ng-container matColumnDef="actions">
          <th mat-header-cell *matHeaderCellDef> Actions </th>
          <td mat-cell *matCellDef="let prop">
            <button mat-icon-button color="primary" (click)="openConfirmationDialog('confirm', prop)" [disabled]="prop.status !== 'En attente'" matTooltip="Confirmer">
              <mat-icon>check</mat-icon>
            </button>
            <button mat-icon-button color="warn" (click)="openConfirmationDialog('reject', prop)" [disabled]="prop.status !== 'En attente'" matTooltip="Refuser">
              <mat-icon>close</mat-icon>
            </button>
            <button mat-icon-button color="accent" (click)="reinitialiser(prop.id)" [disabled]="prop.status === 'En attente'" matTooltip="Réinitialiser">
              <mat-icon>refresh</mat-icon>
            </button>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
      </table>
    </mat-card-content>
  </mat-card>
</div>
